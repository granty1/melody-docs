(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{210:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),a("p",[a("em",[t._v("Melody")]),t._v(" 服务器需要启动和操作的所有配置都是一个配置文件。在所有文档中，此文件都称为"),a("code",[t._v("melody.json")]),t._v("。")]),t._v(" "),a("p",[t._v("但是"),a("code",[t._v("melody.json")]),t._v("只是一个别名，你可以使用任何名字，比如"),a("code",[t._v("example.json")]),t._v("，只是在使用的是要注意修改为：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("melody run -c example.json -d\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("如果配置文件太大或重复，可以使用模板系统将其拆分为多个文件。有关此功能将会在后面的版本推出，这个功能还在进行开发。")])]),t._v(" "),a("h2",{attrs:{id:"生成配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成配置"}},[t._v("#")]),t._v(" 生成配置")]),t._v(" "),a("p",[t._v("配置文件可以从头开始编写，也可以重用另一个现有文件作为基础，但编写第一个配置文件的最简单方法是使用在线配置编辑器 "),a("em",[t._v("Melody Designer")]),t._v(" 。")]),t._v(" "),a("p",[a("em",[t._v("Melody Designer")]),t._v(" 是一个简单的javascript应用程序，它帮助您了解API网关的功能，并帮助您为所有不同的选项设置不同的值。使用此选项不需要从头学习和编写所有属性名。可以随时下载配置文件并重新加载以继续编辑。")]),t._v(" "),a("p",[t._v("立即"),a("a",{attrs:{href:"https://granty1.github.com/melody-config/",target:"_blank",rel:"noopener noreferrer"}},[t._v("生成配置"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"验证配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证配置"}},[t._v("#")]),t._v(" 验证配置")]),t._v(" "),a("p",[a("code",[t._v("melody check")]),t._v("命令验证配置文件的语法：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("melody check -c melody.json\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Syntax OK"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("当语法正确时，您将看到消息语法OK！，否则显示错误。")]),t._v(" "),a("p",[t._v("您还可以直接启动服务，因为这是在服务器启动之前完成的。")]),t._v(" "),a("h2",{attrs:{id:"了解配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#了解配置"}},[t._v("#")]),t._v(" 了解配置")]),t._v(" "),a("p",[t._v("所有的配置都在"),a("code",[t._v("melody.json")]),t._v("中进行，所以你得去熟悉他的内容和语法")]),t._v(" "),a("h3",{attrs:{id:"整体结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体结构"}},[t._v("#")]),t._v(" 整体结构")]),t._v(" "),a("p",[t._v("这个文件中有很多选项，现在我们只关注结构：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"endpoints"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"extra_config"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ...\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("version")]),t._v(": 代表当前使用的 "),a("em",[t._v("Melody")]),t._v(" 的版本，目前使用的是 "),a("code",[t._v("1")])]),t._v(" "),a("li",[a("code",[t._v("endpoints")]),t._v(": 网关提供的端点对象数组以及所有相关的后端和配置，代表客户端到网关这一段。")]),t._v(" "),a("li",[a("code",[t._v("extra_config")]),t._v(": 与中间件或组件相关的额外配置。例如，您可能希望启用日志记录或度量，这是API网关的非核心和可选功能。")])]),t._v(" "),a("h3",{attrs:{id:"endoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#endoint"}},[t._v("#")]),t._v(" "),a("em",[t._v("endoint")])]),t._v(" "),a("p",[t._v("在 endpoint 中，对于每个端点，您都至少要声明一个 backend")]),t._v(" "),a("p",[t._v("看起来像：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"endpoints"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"endpoint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/v1/test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"backends"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url_pattern"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/te"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"host"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://my.api.com"')]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url_pattern"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/st"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"host"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://my.api.com"')]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[t._v("上面的配置声明了 Endpoint: "),a("code",[t._v("/v1/test")]),t._v(", 并且合并了 Backends: "),a("code",[t._v("/te")]),t._v(" 和 "),a("code",[t._v("st")])]),t._v(" "),a("h3",{attrs:{id:"extra-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extra-config"}},[t._v("#")]),t._v(" "),a("em",[t._v("extra_config")])]),t._v(" "),a("p",[t._v("注册Endpoint 之后，"),a("em",[t._v("Melody")]),t._v(" 将从中获取额外配置（如果有的话）")]),t._v(" "),a("p",[t._v("extra_config 将出现在不同的层次，而这完全取决于每个组件。 文件根级别的 "),a("em",[t._v("extra_config")]),t._v(" 通常设置整个服务级别的配置，它能影响到整个 "),a("em",[t._v("Melody")]),t._v(" ， 另外一些组件会在 Endpoint 、Bancked 级别去寻找关键字，此时这些额外的配置是用于限制单个的 Endpoint 或 Backend， 例如，您可能指向限制某个Endpoint下的某个Backend")]),t._v(" "),a("p",[t._v("每个外部的组件都有一个 "),a("strong",[t._v("命名空间")]),t._v(" ，该命名空间用于在初始化阶段去检索您是否启用该组件，例如，go-loggin中间件希望找到一个命名空间"),a("code",[t._v("melody_gologging")])]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"extra_config"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"melody_gologging"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"level"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DEBUG"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"prefix"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[MELODY]"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"syslog"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"stdout"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"支持格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持格式"}},[t._v("#")]),t._v(" 支持格式")]),t._v(" "),a("p",[t._v("默认情况下是"),a("code",[t._v("json")]),t._v("， 但实际上以下扩展名之一，"),a("em",[t._v("Melody")]),t._v(" 都是能解析的")]),t._v(" "),a("ul",[a("li",[a("code",[t._v(".json")])]),t._v(" "),a("li",[a("code",[t._v(".toml")])]),t._v(" "),a("li",[a("code",[t._v(".yaml")])]),t._v(" "),a("li",[a("code",[t._v(".yml")])]),t._v(" "),a("li",[a("code",[t._v(".properties")])]),t._v(" "),a("li",[a("code",[t._v(".props")])]),t._v(" "),a("li",[a("code",[t._v(".prop")])]),t._v(" "),a("li",[a("code",[t._v(".hcl")])])]),t._v(" "),a("p",[t._v("不过最好的建议还是"),a("code",[t._v("json")]),t._v("，这样可以使用"),a("code",[t._v("melody check")]),t._v("去验证配置文件是否合法")])])}),[],!1,null,null,null);s.default=e.exports}}]);